<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>EventEaseHub Login</title>

    <link rel="shortcut icon" href="assets/images/fav.jpg">
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/fontawsom-all.min.css">
    <link rel="stylesheet" type="text/css" href="assets/css/login_style.css" />

    

</head>
<body class="h-100">
    <div class="container-fluid full-bg h-100">
        <div class="container h-100">
            
            <div class="row no-margin">
                <div class="bg-layer  ">  
                    _<form id="loginForm">
                        <div class="login-box row">
                            <i class="fab fa-codepen"></i>
                            <h3>User login</h3>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1"><i class="fas fa-at"></i></span>
                                </div>
                                
                                <input type="email" class="form-control form-control-sm" placeholder="email" aria-label="email" aria-describedby="basic-addon1" name="email">
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text" id="basic-addon1"><i class="fas fa-key"></i></span>
                                </div>
                                <input type="password" class="form-control form-control-sm" placeholder="password" aria-label="password" aria-describedby="basic-addon1" name="password">
                            </div>
                    
                            <button type="submit" class="btn btn-default">Click to Login</button>
                    
                            <p class="no-c">Not a member yet? <a href="create_Account.html">Create your Account</a></p>
                            <button onclick="startGoogleSignin()" class="btn btn-neutral btn-google btn-icon btn-round">
                                <i class="fab fa-google"></i>
                                Sign in with Google
                            </button>
                              <!-- Google Sign-In Button -->
                              <div class="g-signin2" data-onsuccess="onSignIn"></div>
                              <script>
                                function startGoogleSignin() {
                                    var auth2 = gapi.auth2.getAuthInstance();
                                    auth2.signIn().then(function(googleUser) {
                                        var profile = googleUser.getBasicProfile();
                                        var idToken = googleUser.getAuthResponse().id_token;
                            
                                        // Handle the ID token as needed (e.g., send it to your backend for verification)
                                        console.log('ID token:', idToken);
                                    }, function(error) {
                                        console.error('Error signing in with Google:', error);
                                    });
                                }
                            </script>
                            
                            
                        </div>
                    </form>
                    <script>
                        document.getElementById("loginForm").addEventListener("submit", function(event) {
                            event.preventDefault(); // Prevent default form submission
                    
                            var email = document.querySelector('input[name="email"]').value;
                            var password = document.querySelector('input[name="password"]').value;
                    
                            // Basic validation
                            if (!email || !password) {
                                alert('All fields are required');
                                return;
                            }
                    
                            var formData = {
                                email: email,
                                password: password
                            };
                    
                            // Send login data to backend API
                            fetch('http://localhost:8080/users/login', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(formData)
                            })
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error('Network response was not ok');
                                }
                                return response.json(); // Parse JSON response
                            })
                            .then(data => {
                                // Handle successful login
                                if (data.token) {
                                    alert('Login successful!');
                                    // Store the token securely
                                    localStorage.setItem('token', data.token);
                                    // Optionally redirect to a protected route
                                    window.location.href = '/dashboard.html';
                                } else {
                                    alert('Error: ' + data.message);
                                }
                            })
                            .catch(error => {
                                console.error('Error:', error);
                                alert('An error occurred. Please try again.');
                            });
                        });
                    
                        function startGoogleSignin() {
                            var auth2 = gapi.auth2.getAuthInstance();
                            auth2.signIn().then(function(googleUser) {
                                var profile = googleUser.getBasicProfile();
                                var idToken = googleUser.getAuthResponse().id_token;
                    
                                // Handle the ID token as needed (e.g., send it to your backend for verification)
                                console.log('ID token:', idToken);
                            }, function(error) {
                                console.error('Error signing in with Google:', error);
                            });
                        }
                    </script>
                    


                    
                </div>
            </div>

            
        </div>

    </div>
    </body>

    <script src="assets/js/jquery-3.2.1.min.js"></script>
    <script src="assets/js/popper.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/script.js"></script>

</html>
